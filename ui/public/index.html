<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixpanel Import - Data Import Tool</title>
    <link rel="stylesheet" href="style.css">
    <!-- Dropzone -->
    <link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" />
    <script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">
                <span class="logo-icon">üìä</span>
                Mixpanel Import
            </h1>
            <p class="subtitle">Stream data to Mixpanel with powerful transformation tools</p>
        </header>

        <!-- Main Form -->
        <form id="importForm" class="import-form">
            <!-- File Upload Section -->
            <section class="card">
                <h2 class="section-title">üìÅ Data Files</h2>
                <p class="section-description">Drop your JSON, JSONL, CSV, or Parquet files here. Supports local files or cloud storage URLs.</p>
                
                <div id="file-dropzone" class="dropzone-custom">
                    <div class="dropzone-message">
                        <span class="dropzone-icon">‚¨ÜÔ∏è</span>
                        <p>Drop files here or click to browse</p>
                        <small>JSON, JSONL, CSV, Parquet supported</small>
                    </div>
                </div>
                
                <div id="file-list" class="file-list"></div>
            </section>

            <!-- Credentials Section -->
            <section class="card">
                <h2 class="section-title">üîë Mixpanel Credentials</h2>
                <p class="section-description">Your Mixpanel project credentials. Service account authentication is preferred.</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="project">Project ID*</label>
                        <input type="text" id="project" name="project" placeholder="Your project ID" required>
                        <small>Found in your Mixpanel project settings</small>
                    </div>
                    <div class="form-group">
                        <label for="recordType">Record Type*</label>
                        <select id="recordType" name="recordType" required>
                            <option value="event">Events</option>
                            <option value="user">User Profiles</option>
                            <option value="group">Group Profiles</option>
                            <option value="table">Lookup Tables</option>
                        </select>
                        <small>Type of data you're importing</small>
                    </div>
                </div>

                <!-- Auth Method Toggle -->
                <div class="auth-toggle">
                    <label class="toggle-label">
                        <input type="radio" name="authMethod" value="service" checked>
                        Service Account (Recommended)
                    </label>
                    <label class="toggle-label">
                        <input type="radio" name="authMethod" value="secret">
                        API Secret (Legacy)
                    </label>
                </div>

                <!-- Service Account Fields -->
                <div id="service-auth" class="auth-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="acct">Account Username</label>
                            <input type="text" id="acct" name="acct" placeholder="service-account@yourorg.com">
                        </div>
                        <div class="form-group">
                            <label for="pass">Account Password</label>
                            <input type="password" id="pass" name="pass" placeholder="Your service account password">
                        </div>
                    </div>
                </div>

                <!-- API Secret Fields -->
                <div id="secret-auth" class="auth-section" style="display: none;">
                    <div class="form-group">
                        <label for="secret">API Secret</label>
                        <input type="password" id="secret" name="secret" placeholder="Your project's API secret">
                        <small>Legacy authentication method</small>
                    </div>
                </div>

                <!-- Additional Tokens -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="token">Project Token</label>
                        <input type="text" id="token" name="token" placeholder="Required for profiles/groups">
                        <small>Required for user/group profiles</small>
                    </div>
                    <div class="form-group">
                        <label for="groupKey">Group Key</label>
                        <input type="text" id="groupKey" name="groupKey" placeholder="For group profiles">
                        <small>Required for group profile imports</small>
                    </div>
                </div>
            </section>

            <!-- Configuration Section -->
            <section class="card">
                <h2 class="section-title">‚öôÔ∏è Import Configuration</h2>
                <p class="section-description">Fine-tune your import settings for optimal performance and data quality.</p>
                
                <!-- Core Settings -->
                <div class="config-section">
                    <h3 class="subsection-title">Core Settings</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="workers">Concurrency Workers</label>
                            <input type="number" id="workers" name="workers" value="10" min="1" max="50">
                            <small>Number of concurrent HTTP requests (default: 10)</small>
                        </div>
                        <div class="form-group">
                            <label for="recordsPerBatch">Records per Batch</label>
                            <input type="number" id="recordsPerBatch" name="recordsPerBatch" value="2000" min="1" max="5000">
                            <small>Records per API request (default: 2000)</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="region">Data Residency</label>
                            <select id="region" name="region">
                                <option value="US">United States</option>
                                <option value="EU">European Union</option>
                                <option value="IN">India</option>
                            </select>
                            <small>Your Mixpanel data residency region</small>
                        </div>
                        <div class="form-group">
                            <label for="vendor">Data Source</label>
                            <select id="vendor" name="vendor">
                                <option value="">None (Native format)</option>
                                <option value="amplitude">Amplitude</option>
                                <option value="heap">Heap Analytics</option>
                                <option value="ga4">Google Analytics 4</option>
                                <option value="adobe">Adobe Analytics</option>
                                <option value="pendo">Pendo</option>
                                <option value="mparticle">mParticle</option>
                                <option value="posthog">PostHog</option>
                            </select>
                            <small>Transform data from other analytics platforms</small>
                        </div>
                    </div>
                </div>

                <!-- Performance & Processing -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('performance-section')">
                        <span class="section-icon">üìà</span>
                        <h3>Performance & Processing</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="performance-section" class="collapsible-content" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="bytesPerBatch">Bytes per Batch</label>
                                <input type="number" id="bytesPerBatch" name="bytesPerBatch" value="2000000" min="1000" max="2000000">
                                <small>Max bytes per API request (default: 2MB)</small>
                            </div>
                            <div class="form-group">
                                <label for="maxRetries">Max Retries</label>
                                <input type="number" id="maxRetries" name="maxRetries" value="10" min="0" max="50">
                                <small>Maximum retry attempts on failures</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="streamFormat">Stream Format</label>
                                <select id="streamFormat" name="streamFormat">
                                    <option value="jsonl">JSONL (recommended)</option>
                                    <option value="json">JSON</option>
                                    <option value="csv">CSV</option>
                                    <option value="parquet">Parquet</option>
                                </select>
                                <small>Format of underlying data stream</small>
                            </div>
                            <div class="form-group">
                                <label for="transport">HTTP Transport</label>
                                <select id="transport" name="transport">
                                    <option value="got">Got (default)</option>
                                    <option value="undici">Undici</option>
                                </select>
                                <small>HTTP client for sending requests</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="compress" name="compress">
                                    Enable Compression
                                </label>
                                <small>Gzip compress requests (events only)</small>
                            </div>
                            <div class="form-group">
                                <label for="compressionLevel">Compression Level</label>
                                <input type="range" id="compressionLevel" name="compressionLevel" min="0" max="9" value="6">
                                <small>0 = none, 9 = max compression (default: 6)</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Processing -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('data-processing-section')">
                        <span class="section-icon">üîÑ</span>
                        <h3>Data Processing</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="data-processing-section" class="collapsible-content" style="display: none;">
                        <div class="checkbox-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="fixData" name="fixData">
                                Auto-fix Data Issues
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="fixTime" name="fixTime">
                                Fix Timestamp Format
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="strict" name="strict">
                                Strict Validation
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="removeNulls" name="removeNulls">
                                Remove Null Values
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="flattenData" name="flattenData">
                                Flatten Nested Objects
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="fixJson" name="fixJson">
                                Fix Malformed JSON
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="dedupe" name="dedupe">
                                Deduplicate Records
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="addToken" name="addToken">
                                Add Token to Records
                            </label>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="timeOffset">Time Offset (hours)</label>
                                <input type="number" id="timeOffset" name="timeOffset" value="0" step="0.5">
                                <small>Add/subtract hours from timestamps</small>
                            </div>
                            <div class="form-group">
                                <label for="insertIdTuple">Insert ID Columns</label>
                                <input type="text" id="insertIdTuple" name="insertIdTuple" placeholder="col1,col2">
                                <small>Comma-separated column names for generated insert_id</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filtering & Lists -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('filtering-section')">
                        <span class="section-icon">üîç</span>
                        <h3>Filtering & Lists</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="filtering-section" class="collapsible-content" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="eventWhitelist">Event Whitelist</label>
                                <input type="text" id="eventWhitelist" name="eventWhitelist" placeholder="event1,event2">
                                <small>Only import these events (comma-separated)</small>
                            </div>
                            <div class="form-group">
                                <label for="eventBlacklist">Event Blacklist</label>
                                <input type="text" id="eventBlacklist" name="eventBlacklist" placeholder="spam_event,test_event">
                                <small>Skip these events (comma-separated)</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="propKeyWhitelist">Property Key Whitelist</label>
                                <input type="text" id="propKeyWhitelist" name="propKeyWhitelist" placeholder="user_id,plan">
                                <small>Only events with these property keys</small>
                            </div>
                            <div class="form-group">
                                <label for="propKeyBlacklist">Property Key Blacklist</label>
                                <input type="text" id="propKeyBlacklist" name="propKeyBlacklist" placeholder="pii_field,secret">
                                <small>Skip events with these property keys</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="propValWhitelist">Property Value Whitelist</label>
                                <input type="text" id="propValWhitelist" name="propValWhitelist" placeholder="premium,enterprise">
                                <small>Only events with these property values</small>
                            </div>
                            <div class="form-group">
                                <label for="propValBlacklist">Property Value Blacklist</label>
                                <input type="text" id="propValBlacklist" name="propValBlacklist" placeholder="test,internal">
                                <small>Skip events with these property values</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="scrubProps">Properties to Remove</label>
                                <input type="text" id="scrubProps" name="scrubProps" placeholder="password,ssn,email">
                                <small>Remove these properties from all records</small>
                            </div>
                            <div class="form-group">
                                <label for="aliases">Property Aliases (JSON)</label>
                                <input type="text" id="aliases" name="aliases" placeholder='{"old_name":"new_name"}'>
                                <small>Rename properties: {"oldKey":"newKey"}</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Time & Date Filters -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('time-section')">
                        <span class="section-icon">üìÖ</span>
                        <h3>Time & Date Filters</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="time-section" class="collapsible-content" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="epochStart">Start Timestamp (Unix)</label>
                                <input type="number" id="epochStart" name="epochStart" placeholder="1609459200">
                                <small>Skip data before this Unix timestamp</small>
                            </div>
                            <div class="form-group">
                                <label for="epochEnd">End Timestamp (Unix)</label>
                                <input type="number" id="epochEnd" name="epochEnd" placeholder="1609459200">
                                <small>Skip data after this Unix timestamp</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="start">Start Date (Export)</label>
                                <input type="date" id="start" name="start">
                                <small>Start date for data exports</small>
                            </div>
                            <div class="form-group">
                                <label for="end">End Date (Export)</label>
                                <input type="date" id="end" name="end">
                                <small>End date for data exports</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Output & File Options -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('output-section')">
                        <span class="section-icon">üíæ</span>
                        <h3>Output & File Options</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="output-section" class="collapsible-content" style="display: none;">
                        <div class="checkbox-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="logs" name="logs">
                                Save Import Logs
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="verbose" name="verbose">
                                Verbose Console Output
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showProgress" name="showProgress">
                                Show Progress Bar
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="writeToFile" name="writeToFile">
                                Write to Local File
                            </label>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="where">Output Directory</label>
                                <input type="text" id="where" name="where" placeholder="./logs">
                                <small>Directory for logs and exported files</small>
                            </div>
                            <div class="form-group">
                                <label for="outputFilePath">Output File Path</label>
                                <input type="text" id="outputFilePath" name="outputFilePath" placeholder="./output.json">
                                <small>Path for transformed data output</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Expert Settings -->
                <div class="collapsible-section">
                    <div class="section-header" onclick="toggleSection('expert-section')">
                        <span class="section-icon">üî¨</span>
                        <h3>Expert Settings</h3>
                        <span class="toggle-icon">‚ñº</span>
                    </div>
                    <div id="expert-section" class="collapsible-content" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="tags">Global Tags (JSON)</label>
                                <input type="text" id="tags" name="tags" placeholder='{"source":"import","version":"1.0"}'>
                                <small>Tags added to all records: {"key":"value"}</small>
                            </div>
                            <div class="form-group">
                                <label for="vendorOpts">Vendor Options (JSON)</label>
                                <input type="text" id="vendorOpts" name="vendorOpts" placeholder='{"user_id":"uuid"}'>
                                <small>Vendor-specific transform options</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="whereClause">Where Clause (Export)</label>
                                <input type="text" id="whereClause" name="whereClause" placeholder='properties["plan"] == "premium"'>
                                <small>Filter clause for data exports</small>
                            </div>
                            <div class="form-group">
                                <label for="limit">Export Limit</label>
                                <input type="number" id="limit" name="limit" placeholder="1000000">
                                <small>Maximum records to export</small>
                            </div>
                        </div>

                        <div class="checkbox-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="forceStream" name="forceStream">
                                Force Stream Mode
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="abridged" name="abridged">
                                Abridged Responses
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="http2" name="http2">
                                Use HTTP/2
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="keepBadRecords" name="keepBadRecords">
                                Keep Bad Records
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transform Section -->
            <section class="card">
                <h2 class="section-title">üîß Data Transform (Optional)</h2>
                <p class="section-description">Write custom JavaScript to transform your data before importing. Use the preview to test your changes.</p>
                
                <div class="transform-editor">
                    <div id="monaco-editor" class="code-editor"></div>
                    <div class="editor-help">
                        <p><strong>Available parameters:</strong></p>
                        <ul>
                            <li><code>data</code> - The current record object</li>
                            <li><code>heavy</code> - Heavy objects (Job instance with utilities)</li>
                        </ul>
                        <p><strong>Example:</strong> <code>return { ...data, custom_property: 'value' };</code></p>
                    </div>
                </div>

                <div class="transform-actions">
                    <button type="button" id="preview-btn" class="btn btn-secondary">
                        <span class="btn-icon">üëÄ</span>
                        Preview Transform
                    </button>
                    <button type="button" id="clear-transform" class="btn btn-ghost">Clear</button>
                </div>

                <div id="preview-results" class="preview-section" style="display: none;">
                    <h3>Transform Preview</h3>
                    <div id="preview-content" class="preview-content"></div>
                </div>
            </section>

            <!-- Actions -->
            <section class="actions">
                <button type="button" id="dry-run-btn" class="btn btn-secondary">
                    <span class="btn-icon">üß™</span>
                    Test Run (Dry Run)
                </button>
                <button type="submit" id="import-btn" class="btn btn-primary">
                    <span class="btn-icon">üöÄ</span>
                    Start Import
                </button>
            </section>

            <!-- Loading State -->
            <div id="loading" class="loading-overlay" style="display: none;">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <h3 id="loading-title">Processing...</h3>
                    <p id="loading-message">Importing your data to Mixpanel</p>
                </div>
            </div>

            <!-- Results -->
            <div id="results" class="results-section" style="display: none;">
                <div class="results-content">
                    <h3 id="results-title">Import Complete!</h3>
                    <div id="results-data" class="results-data"></div>
                </div>
            </div>
        </form>
    </div>

    <script src="app.js"></script>
</body>
</html>